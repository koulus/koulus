(window["webpackJsonplukiokalenteri-ui"]=window["webpackJsonplukiokalenteri-ui"]||[]).push([[1],{53:function(e,t,a){e.exports=a(85)},58:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),l=a(28),i=a.n(l),c=(a(58),a(52));var o=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(c.a,{onClick:function(){window.location.href="https://vilkkuv.fi/koulu/api/auth/start"}}))},r=a(11),u=a(23),m=a(13),h=a(14),d=a(17),p=a(15),f=a(6),E=a(16),v=a(24),k=a.n(v),g=a(90),b=a(18),y=[{path:"/",exact:!0,name:"Etusivu"},{path:"/nyt",name:"Nyt",component:s.a.lazy(function(){return a.e(4).then(a.bind(null,95))})}],j={items:[{name:"Nyt",url:"/nyt",icon:"cui-dashboard"},{name:"Jakso",url:"/jakso",icon:"cui-calendar"}]},S=s.a.lazy(function(){return a.e(0).then(a.bind(null,96))}),O=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).loading=function(){return s.a.createElement("div",{className:"animated fadeIn pt-1 text-center"},"Ladataan...")},a}return Object(E.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"app"},s.a.createElement(b.a,{fixed:!0},s.a.createElement(n.Suspense,{fallback:this.loading()},s.a.createElement(S,{user:this.props.user}))),s.a.createElement("div",{className:"app-body"},s.a.createElement(b.b,{fixed:!0,display:"lg"},s.a.createElement(b.e,null),s.a.createElement(b.d,null),s.a.createElement(n.Suspense,null,s.a.createElement(b.g,Object.assign({navConfig:j},this.props,{router:r}))),s.a.createElement(b.c,null),s.a.createElement(b.f,null)),s.a.createElement("main",{className:"main"},s.a.createElement(g.a,{fluid:!0},s.a.createElement(n.Suspense,{fallback:this.loading()},s.a.createElement(u.g,null,y.map(function(e,t){return e.component?s.a.createElement(u.d,{key:t,path:e.path,exact:e.exact,name:e.name,render:function(t){return s.a.createElement(e.component,t)}}):null}),s.a.createElement(u.c,{from:"/",to:"/nyt"})))))))}}]),t}(n.Component),N=a(91),x=a(92),C=a(87),w=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={school:e.schools[0]},a}return Object(E.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("h3",{className:"text-center m-5"},"Opiskeletko koulussa ",this.state.school.name,"?"),s.a.createElement(N.a,{className:"align-items-center",tag:"div"},s.a.createElement(x.a,{col:"6",sm:"6",md:"6",xl:!0,className:"mb-3 mb-xl-0"},s.a.createElement(C.a,{block:!0,color:"primary",onClick:function(t){return e.props.yes(e.state.school._id)}},"Kyll\xe4")),s.a.createElement(x.a,{col:"6",sm:"6",md:"6",xl:!0,className:"mb-3 mb-xl-0"},s.a.createElement(C.a,{block:!0,color:"secondary",onClick:this.props.no},"En"))))}}]),t}(n.Component),V=a(93),_=a(94),I=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={schools:a.props.schools.sort(function(e,t){return e.name.localeCompare(t.name)}),value:0},a.onChange=a.onChange.bind(Object(f.a)(a)),a}return Object(E.a)(t,e),Object(h.a)(t,[{key:"onChange",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("h3",{className:"text-center m-5"},"Valitse koulusi valikosta."),s.a.createElement(V.a,null,s.a.createElement(_.a,{type:"select",onChange:this.onChange},s.a.createElement("option",{value:"0"},"Valitse t\xe4st\xe4"),this.state.schools.map(function(e,t){return s.a.createElement("option",{key:e._id,value:e._id},e.name)}))),s.a.createElement(N.a,{className:"align-items-center",tag:"div"},s.a.createElement(x.a,{col:"6",sm:"6",md:"6",xl:!0,className:"mb-3 mb-xl-0"},s.a.createElement(C.a,{disabled:0==this.state.value,block:!0,color:"primary",onClick:function(t){return e.props.select(e.state.value)}},"Vahvista")),s.a.createElement(x.a,{col:"6",sm:"6",md:"6",xl:!0,className:"mb-3 mb-xl-0"},s.a.createElement(C.a,{block:!0,color:"secondary",onClick:this.props.no},"Kouluani ei ole listalla"))))}}]),t}(n.Component),U=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).loading=function(){return s.a.createElement("div",{className:"animated fadeIn pt-1 text-center"},"Ladataan...")},a.state={status:"loading",schools:[]},a.getSchools=a.getSchools.bind(Object(f.a)(a)),a.selectSchool=a.selectSchool.bind(Object(f.a)(a)),a.noConfirm=a.noConfirm.bind(Object(f.a)(a)),a}return Object(E.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.getSchools()}},{key:"selectSchool",value:function(e){var t=this;this.setState({status:"loading"}),k.a.post("https://vilkkuv.fi/koulu/api/user/schoolSelect",JSON.stringify({id:e}),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("access_token")),"Content-Type":"application/json"}}).then(function(e){e.data.success&&t.props.refresh()})}},{key:"noConfirm",value:function(){this.setState({status:"unsupported"})}},{key:"getSchools",value:function(){var e=this;k.a.get("https://vilkkuv.fi/koulu/api/user/schoolSelect",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("access_token"))}}).then(function(t){var a=t.data;a.success&&(0==a.schools.length?e.setState({status:"unsupported"}):1==a.schools.length?a.schools[0].unique_domain?e.selectSchool(a.schools[0]._id):e.setState({status:"confirm",schools:a.schools}):e.setState({status:"multiple",schools:a.schools}))})}},{key:"render",value:function(){return s.a.createElement("div",{className:"app"},s.a.createElement(b.a,{fixed:!0},s.a.createElement(n.Suspense,{fallback:this.loading()})),s.a.createElement("div",{className:"app-body"},s.a.createElement("main",{className:"main"},s.a.createElement(g.a,{fluid:!0},s.a.createElement(n.Suspense,{fallback:this.loading()},"loading"==this.state.status&&this.loading(),"unsupported"==this.state.status&&s.a.createElement("div",{className:"text-center m-5"},s.a.createElement("h3",null,"Valitettavasti palvelu ei tue kouluasi t\xe4ll\xe4 hetkell\xe4."),s.a.createElement("p",null,"V\xe4\xe4r\xe4n koulun valitseminen ei my\xf6sk\xe4\xe4n auta, sill\xe4 silloin et saa juuri sinun kouluusi liittyv\xe4\xe4 tietoa."),s.a.createElement("p",null,"Voit pyyt\xe4 koulusi lis\xe4yst\xe4 l\xe4hett\xe4m\xe4ll\xe4 s\xe4hk\xf6postia osoitteeseen ",s.a.createElement("strong",null,"viljami@vilkkuv.fi"),".")),"confirm"==this.state.status&&s.a.createElement(w,{schools:this.state.schools,no:this.noConfirm,yes:this.selectSchool}),"multiple"==this.state.status&&s.a.createElement(I,{schools:this.state.schools,no:this.noConfirm,select:this.selectSchool}))))))}}]),t}(n.Component),D=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).loading=function(){return s.a.createElement("div",{className:"animated fadeIn pt-1 text-center"},"Ladataan...")},a.state={status:"form",url:"",isValid:!1},a.isValid=a.isValid.bind(Object(f.a)(a)),a.submitUrl=a.submitUrl.bind(Object(f.a)(a)),a.onChange=a.onChange.bind(Object(f.a)(a)),a}return Object(E.a)(t,e),Object(h.a)(t,[{key:"isValid",value:function(e){return e.includes("/schedule/export/students/")&&e.includes("https://")}},{key:"onChange",value:function(e){var t=e.target.value;this.setState({url:t,isValid:this.isValid(t),status:"form"})}},{key:"submitUrl",value:function(){var e=this;this.setState({status:"submitting"}),k.a.post("https://vilkkuv.fi/koulu/api/user/wilma",JSON.stringify({url:this.state.url}),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("access_token")),"Content-Type":"application/json"}}).then(function(t){t.data.success?e.props.refresh():e.setState({status:"form"})})}},{key:"render",value:function(){return s.a.createElement("div",{className:"app"},s.a.createElement(b.a,{fixed:!0},s.a.createElement(n.Suspense,{fallback:this.loading()})),s.a.createElement("div",{className:"app-body"},s.a.createElement("main",{className:"main"},s.a.createElement(g.a,{fluid:!0},s.a.createElement(n.Suspense,{fallback:this.loading()},"form"==this.state.status&&s.a.createElement(s.a.Fragment,null,s.a.createElement("h3",{className:"text-center m-5"},"Liit\xe4 Wilman ty\xf6j\xe4rjestyksen tilauslinkki alla olevaan kentt\xe4\xe4n."),s.a.createElement(V.a,{row:!0,className:"justify-content-center"},s.a.createElement(x.a,{md:"9"},s.a.createElement(_.a,{onChange:this.onChange,type:"text",id:"text-input",name:"text-input",invalid:!this.state.isValid&&""!=this.state.url,valid:this.state.isValid,placeholder:"Liit\xe4 linkki t\xe4h\xe4n"}))),s.a.createElement(N.a,{className:"justify-content-center"},s.a.createElement(x.a,{md:"9"},s.a.createElement(C.a,{block:!0,disabled:!this.state.isValid,onClick:this.submitUrl,color:"primary"},"Vahvista")))),"submitting"==this.state.status&&s.a.createElement(s.a.Fragment,null,s.a.createElement("h3",{className:"text-center m-5"},"Tietojasi ladataan..."),s.a.createElement("p",{className:"text-center"},"T\xe4ss\xe4 voi kest\xe4\xe4 useita kymmeni\xe4 sekunteja."),s.a.createElement("p",{className:"text-center"},s.a.createElement("strong",null,"Eth\xe4n sulje t\xe4t\xe4 sivua kesken latauksen.")),s.a.createElement(N.a,{className:"justify-content-center"},s.a.createElement("i",{className:"fa fa-spinner fa-lg fa-spin mt-4"}))))))))}}]),t}(n.Component),L=(s.a.lazy(function(){return a.e(0).then(a.bind(null,96))}),function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).loading=function(){return s.a.createElement("div",{className:"animated fadeIn pt-1 text-center"},"Ladataan...")},a.state={loadingState:"loading",user:{}},a.getUserData=a.getUserData.bind(Object(f.a)(a)),a}return Object(E.a)(t,e),Object(h.a)(t,[{key:"getUserData",value:function(){var e=this;k.a.get("https://vilkkuv.fi/koulu/api/user/me",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("access_token"))}}).then(function(t){var a=t.data;a.success?e.setState({user:a,loadingState:"ready"}):"school_not_selected"==a.error?e.setState({loadingState:"schoolSelect"}):"wilma_url_missing"==a.error&&e.setState({loadingState:"wilmaUrl"})})}},{key:"componentDidMount",value:function(){this.getUserData()}},{key:"render",value:function(){return"loading"===this.state.loadingState?s.a.createElement("div",{className:"app"},s.a.createElement("div",{className:"animated fadeIn pt-1 text-center"},"Ladataan...")):"schoolSelect"===this.state.loadingState?s.a.createElement("div",{className:"app"},s.a.createElement(U,{refresh:this.getUserData})):"wilmaUrl"===this.state.loadingState?s.a.createElement("div",{className:"app"},s.a.createElement(D,{refresh:this.getUserData})):"ready"===this.state.loadingState?s.a.createElement("div",{className:"app"},s.a.createElement(O,{user:this.state.user})):void 0}}]),t}(n.Component));a(84),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var z=new URL(window.location).searchParams.get("token");null!=z&&(localStorage.setItem("access_token",z),window.history.pushState("",document.title,window.location.origin));var B=!1;null!==localStorage.getItem("access_token")&&"a"!==localStorage.getItem("access_token")&&(B=!0),i.a.render(s.a.createElement(r.BrowserRouter,null,B?s.a.createElement(u.d,{component:L}):s.a.createElement(s.a.Fragment,null,s.a.createElement(u.c,{to:"/"}),s.a.createElement(u.d,{component:o}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[53,2,3]]]);
//# sourceMappingURL=main.17008a88.chunk.js.map